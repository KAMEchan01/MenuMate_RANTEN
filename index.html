<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MenuMate - ÊãÖ„ÄÖÈ∫∫„Å®„Çµ„É©„ÉÄ„ÅÆÂ∫ó„Çâ„Çì„Å¶„ÇìÂ∞ÇÁî®„Ç¢„Éó„É™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: 
                linear-gradient(135deg, rgba(214,48,49,0.3) 0%, rgba(0,0,0,0.2) 50%, rgba(255,255,255,0.4) 100%),
                url('ËÉåÊôØ„Ç§„É°„Éº„Ç∏ÔºîÂìÅ.png') center/cover no-repeat;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #d63031, #000000);
            padding: 30px 20px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 30px 20px;
        }

        .question {
            margin-bottom: 30px;
        }

        .question h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .required {
            color: #d63031;
            font-size: 12px;
            font-weight: normal;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .choice-btn {
            flex: 1;
            padding: 15px 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .choice-btn.selected {
            background: #d63031;
            color: white;
            border-color: #d63031;
        }


        .allergy-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .allergy-btn {
            padding: 12px 8px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .allergy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .allergy-btn.selected {
            background: #fdcb6e;
            color: white;
            border-color: #fdcb6e;
        }

        .no-allergy-btn {
            width: 100%;
            padding: 12px;
            border: 2px solid #00b894;
            background: white;
            color: #00b894;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .no-allergy-btn:hover {
            background: #00b894;
            color: white;
        }

        .no-allergy-btn.selected {
            background: #00b894;
            color: white;
        }

        .optional-btn {
            width: 100%;
            padding: 15px;
            border: 2px dashed #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .optional-btn:hover {
            background: #fff3cd;
            border-color: #feca57;
        }

        .optional-btn.selected {
            background: #feca57;
            color: white;
            border-color: #feca57;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #d63031, #000000);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            display: none;
        }

        .result-card {
            background: linear-gradient(135deg, #f82258, #f83b3b);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: white;
        }

        .result-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .result-header h3 {
            color: white;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        .menu-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid rgba(255,255,255,0.5);
        }

        .menu-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .menu-price {
            font-weight: bold;
            color: white;
        }

        .signature-badge {
            background: #feca57;
            color: #333;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 8px;
        }

        .comment {
            background: #fff3cd;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #feca57;
        }

        .comment p {
            color: #333;
            font-size: 16px;
            line-height: 1.5;
        }

        .allergy-warning {
            background: #ffebe6;
            border: 2px solid #ff7675;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }

        .allergy-warning h4 {
            color: #d63031;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .allergy-warning p {
            color: #333;
            font-size: 13px;
            line-height: 1.4;
        }

        .spicy-adjust {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .spicy-adjust h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .spicy-adjust-buttons {
            display: flex;
            gap: 10px;
        }

        .spicy-adjust-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .spicy-adjust-btn:hover {
            background: #ff7675;
            color: white;
            border-color: #ff7675;
        }

        .final-btn {
            width: 100%;
            padding: 18px;
            background: #00b894;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .final-btn:hover {
            background: #00a085;
            transform: translateY(-2px);
        }

        .back-btn {
            width: 100%;
            padding: 15px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .back-btn:hover {
            background: #545b62;
        }

        @media (max-width: 480px) {
            .container {
                margin: 10px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .choice-btn {
                min-width: 100%;
            }

            .allergy-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçú MenuMate</h1>
            <img src="„Çâ„Çì„Å¶„ÇìÂ∫óÂêç„É≠„Ç¥.png" alt="„Çâ„Çì„Å¶„ÇìÂ∫óÂêç„É≠„Ç¥" style="height: 60px; margin: 10px 0; object-fit: contain;">
            <p>Ëæõ„Åï„Å®„Ç¢„É¨„É´„ÇÆ„Éº„Å´ÈÖçÊÖÆ„Åó„ÅüÊèêÊ°à„Çí„Åó„Åæ„Åô</p>
        </div>

        <div id="selection-screen" class="content">
            <div class="question">
                <h3>üí∞ „Åî‰∫àÁÆó„ÅØ„ÅÑ„Åã„Åå„Åß„Åô„ÅãÔºü <span class="required">‚ÄªÂøÖÈ†à</span></h3>
                <div class="button-group">
                    <button class="choice-btn" data-budget="luxury">Ë¥ÖÊ≤¢<br><small>1500ÂÜÜ„Äú</small></button>
                    <button class="choice-btn" data-budget="normal">ÊôÆÈÄö<br><small>1000ÂÜÜÁ®ãÂ∫¶</small></button>
                    <button class="choice-btn" data-budget="light">Êéß„Åà„ÇÅ<br><small>600ÂÜÜ‰ª•‰∏ã</small></button>
                </div>
            </div>

            <div class="question">
                <h3>üå∂Ô∏è Ëæõ„Åï„ÅÆÂ•Ω„Åø„ÅØÔºü <span class="required">‚ÄªÂøÖÈ†à</span></h3>
                <div class="button-group">
                    <button class="choice-btn" data-spicy="1">„Éû„Ç§„É´„Éâ<br><small>ÂÑ™„Åó„ÅÑËæõ„Åï</small></button>
                    <button class="choice-btn" data-spicy="3">‰∏≠Ëæõ<br><small>Á®ã„Çà„ÅÑËæõ„Åï</small></button>
                    <button class="choice-btn" data-spicy="5">ËæõÂè£<br><small>„Åó„Å£„Åã„ÇäËæõ„ÅÑ</small></button>
                </div>
            </div>

            <div class="question">
                <h3>‚ö†Ô∏è „Ç¢„É¨„É´„ÇÆ„Éº„Åå„ÅÇ„Çã„ÇÇ„ÅÆ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ <span class="required">‚ÄªÂøÖÈ†à</span></h3>
                <div class="allergy-grid">
                    <button class="allergy-btn" data-allergy="Â∞èÈ∫¶">Â∞èÈ∫¶</button>
                    <button class="allergy-btn" data-allergy="Â§ßË±Ü">Â§ßË±Ü</button>
                    <button class="allergy-btn" data-allergy="Âçµ">Âçµ</button>
                    <button class="allergy-btn" data-allergy="‰π≥Ë£ΩÂìÅ">‰π≥Ë£ΩÂìÅ</button>
                    <button class="allergy-btn" data-allergy="„Åî„Åæ">„Åî„Åæ</button>
                    <button class="allergy-btn" data-allergy="„Åà„Å≥">„Åà„Å≥</button>
                    <button class="allergy-btn" data-allergy="È∂èËÇâ">È∂èËÇâ</button>
                    <button class="allergy-btn" data-allergy="Ë±öËÇâ">Ë±öËÇâ</button>
                </div>
                <button class="no-allergy-btn" id="no-allergy-btn">„Ç¢„É¨„É´„ÇÆ„Éº„Å™„Åó</button>
            </div>

            <div class="question">
                <h3>‚ú® ‰ªäÊó•„ÅÆÊ∞óÂàÜ„ÅØÔºü</h3>
                <div class="button-group">
                    <button class="optional-btn" data-mood="hearty">„Åå„Å£„Å§„ÇäÁ≥ª<br><small>Ê∫ÄËÖπÈáçË¶ñ</small></button>
                    <button class="optional-btn" data-mood="healthy">„ÅÇ„Å£„Åï„ÇäÁ≥ª<br><small>„Éò„É´„Ç∑„ÉºÈáçË¶ñ</small></button>
                </div>
            </div>

            <button id="submit-btn" class="submit-btn" disabled>üéØ „Åä„Åô„Åô„ÇÅ„ÇíÊïô„Åà„Å¶ÔºÅ</button>
        </div>

        <div id="result-screen" class="content result">
            <div class="result-card">
                <div class="result-header">
                    <h3>üí° „Çâ„Çì„Å¶„ÇìMenuMate„Åã„Çâ„ÅÆÊèêÊ°à</h3>
                </div>
                <div id="menu-items"></div>
            </div>

            <div class="comment">
                <p id="comment-text"></p>
            </div>

            <div id="allergy-warning" class="allergy-warning" style="display: none;">
                <h4>‚ö†Ô∏è „Ç¢„É¨„É´„ÇÆ„ÉºÊÉÖÂ†±</h4>
                <p id="allergy-warning-text"></p>
            </div>

            <div class="spicy-adjust">
                <h4>üå∂Ô∏è Ëæõ„ÅïË™øÊï¥</h4>
                <div class="spicy-adjust-buttons">
                    <button class="spicy-adjust-btn" onclick="adjustSpiciness(-1)">„Çà„ÇäÂº±„Åè</button>
                    <button class="spicy-adjust-btn" onclick="adjustSpiciness(0)">„Åì„ÅÆ„Åæ„Åæ</button>
                    <button class="spicy-adjust-btn" onclick="adjustSpiciness(1)">„Çà„ÇäËæõ„Åè</button>
                </div>
            </div>

            <button class="final-btn" onclick="finalDecision()">‚úÖ „Åì„Çå„ÅßÊ≥®Êñá„Åó„Åæ„ÅôÔºÅ</button>
            <button class="back-btn" onclick="goBack()">‚Üê ÊúÄÂàù„Åã„ÇâÈÅ∏„Å≥Áõ¥„Åô</button>
        </div>

        <div id="final-screen" class="content result">
            <div class="result-header" style="text-align: center; margin-bottom: 30px;">
                <h3>üéâ Á¥†Êïµ„Å™„ÅäÈ£ü‰∫ã„Çí<br>„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑ üéâ</h3>
            </div>
            
            <div class="result-card">
                <div class="result-header">
                    <h3>üìã „ÅîÊ≥®ÊñáÂÜÖÂÆπ</h3>
                </div>
                <div id="final-menu-items"></div>
            </div>

            <div class="comment">
                <p id="final-comment-text"></p>
            </div>
            
            <button class="back-btn" onclick="restart()">‚Üê Êñ∞„Åó„ÅèÈÅ∏„Å∂</button>
        </div>
    </div>

    <script type="module">
        import menuDatabase from './src/menuDatabase.js';

        // ÈÅ∏ÊäûÁä∂ÊÖã
        let selections = {
            budget: null,
            spiciness: null,
            allergies: [],
            mood: null
        };

        let currentSuggestion = null;

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // ‰∫àÁÆóÈÅ∏Êäû„Éú„Çø„É≥
            document.querySelectorAll('[data-budget]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-budget]').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selections.budget = this.dataset.budget;
                    checkSubmitButton();
                });
            });

            // Ëæõ„ÅïÈÅ∏Êäû„Éú„Çø„É≥
            document.querySelectorAll('[data-spicy]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-spicy]').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selections.spiciness = parseInt(this.dataset.spicy);
                    checkSubmitButton();
                });
            });

            // „Ç¢„É¨„É´„ÇÆ„ÉºÈÅ∏Êäû„Éú„Çø„É≥
            document.querySelectorAll('[data-allergy]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const allergy = this.dataset.allergy;
                    
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selections.allergies = selections.allergies.filter(a => a !== allergy);
                    } else {
                        this.classList.add('selected');
                        selections.allergies.push(allergy);
                        // „Ç¢„É¨„É´„ÇÆ„Éº„ÅÇ„Çä„ÇíÈÅ∏Êäû„Åó„ÅüÂ†¥Âêà„ÄÅ„Ç¢„É¨„É´„ÇÆ„Éº„Å™„Åó„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
                        document.getElementById('no-allergy-btn').classList.remove('selected');
                    }
                    checkSubmitButton();
                });
            });

            // „Ç¢„É¨„É´„ÇÆ„Éº„Å™„Åó„Éú„Çø„É≥
            document.getElementById('no-allergy-btn').addEventListener('click', function() {
                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                } else {
                    this.classList.add('selected');
                    // ‰ªñ„ÅÆ„Ç¢„É¨„É´„ÇÆ„Éº„Éú„Çø„É≥„Çí„Åô„Åπ„Å¶ÁÑ°ÂäπÂåñ
                    document.querySelectorAll('[data-allergy]').forEach(btn => btn.classList.remove('selected'));
                    selections.allergies = [];
                }
                checkSubmitButton();
            });

            // Ê∞óÂàÜ„Éú„Çø„É≥Ôºà‰ªªÊÑèÔºâ
            document.querySelectorAll('[data-mood]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-mood]').forEach(b => b.classList.remove('selected'));
                    
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selections.mood = null;
                    } else {
                        this.classList.add('selected');
                        selections.mood = this.dataset.mood;
                    }
                });
            });

            // ÊèêÊ°à„Éú„Çø„É≥
            document.getElementById('submit-btn').addEventListener('click', function() {
                generateSuggestion();
            });
        }

        function checkSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            const allergySelected = selections.allergies.length > 0 || document.getElementById('no-allergy-btn').classList.contains('selected');
            
            if (selections.budget && selections.spiciness !== null && allergySelected) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        function generateSuggestion() {
            const suggestion = createSuggestion(selections);
            currentSuggestion = suggestion;
            displaySuggestion(suggestion);
            showResultScreen();
        }

        function createSuggestion(selections) {
            const budget = getBudgetRange(selections.budget);
            const spiciness = selections.spiciness;
            const allergies = selections.allergies;
            const mood = selections.mood;
            
            // „Ç¢„É¨„É´„ÇÆ„ÉºÂØæÂøú„É°„Éã„É•„Éº„ÇíÂèñÂæó
            let availableMenus = menuDatabase.getMenusWithoutAllergens(allergies);
            
            // Ëæõ„Åï„É¨„Éô„É´„Å´ÈÅ©„Åó„Åü„É°„Éã„É•„Éº„ÇíÂÑ™ÂÖà
            let suitableMenus = availableMenus.filter(menu => {
                if (menu.spicyLevel === 0) return true; // Ëæõ„Åè„Å™„ÅÑ„É°„Éã„É•„Éº„ÅØÂ∏∏„Å´ÈÅ©Áî®
                return Math.abs(menu.spicyLevel - spiciness) <= 1; // ¬±1„É¨„Éô„É´„Åæ„ÅßË®±ÂÆπ
            });
            
            // ÈÅ©Âàá„Å™„É°„Éã„É•„Éº„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÂÖ®„É°„Éã„É•„Éº„Åã„ÇâÈÅ∏Êäû
            if (suitableMenus.length === 0) {
                suitableMenus = availableMenus;
            }
            
            // ‰∫àÁÆóÂÜÖ„ÅÆ„É°„Éã„É•„Éº„ÇíÈÅ∏Êäû
            const affordableMenus = suitableMenus.filter(menu => menu.price <= budget.max);
            
            if (affordableMenus.length === 0) {
                return createFallbackSuggestion(budget, allergies);
            }
            
            // Ë¥ÖÊ≤¢‰∫àÁÆó„ÅÆÂ†¥Âêà„ÅÆÁâπÂà•Âá¶ÁêÜÔºà3ÂìÅ„Çª„ÉÉ„ÉàÔºâ
            if (selections.budget === 'luxury') {
                // ÊãÖ„ÄÖÈ∫∫„Åæ„Åü„ÅØÊπØÈ∫∫„Åã„Çâ1ÂìÅÈÅ∏Êäû
                const noodleMenus = [...menuDatabase.tantanmen, ...menuDatabase.yunmen].filter(menu => 
                    !allergies.some(allergen => menu.allergens.includes(allergen))
                );
                
                // „Çµ„É©„ÉÄ„Åã„Çâ1ÂìÅÈÅ∏Êäû
                const saladMenus = menuDatabase.salads.filter(salad => 
                    !allergies.some(allergen => salad.allergens.includes(allergen))
                );
                
                // „Çµ„Ç§„Éâ„É°„Éã„É•„Éº„Åã„Çâ1ÂìÅÈÅ∏Êäû
                const sideMenus = menuDatabase.sides.filter(side => 
                    !allergies.some(allergen => side.allergens.includes(allergen))
                );
                
                if (noodleMenus.length > 0 && saladMenus.length > 0 && sideMenus.length > 0) {
                    // Ëæõ„Åï„É¨„Éô„É´„Å´ÈÅ©„Åó„ÅüÈ∫∫È°û„ÇíÂÑ™ÂÖàÈÅ∏Êäû
                    let suitableNoodles = noodleMenus.filter(menu => {
                        if (menu.spicyLevel === 0) return true;
                        return Math.abs(menu.spicyLevel - spiciness) <= 1;
                    });
                    if (suitableNoodles.length === 0) suitableNoodles = noodleMenus;
                    
                    const selectedNoodle = suitableNoodles[Math.floor(Math.random() * suitableNoodles.length)];
                    const selectedSalad = saladMenus[Math.floor(Math.random() * saladMenus.length)];
                    const selectedSide = sideMenus[Math.floor(Math.random() * sideMenus.length)];
                    
                    const totalPrice = selectedNoodle.price + selectedSalad.price + selectedSide.price;
                    
                    // Ëæõ„ÅïË™øÊï¥
                    const adjustedNoodle = {
                        ...selectedNoodle,
                        adjustedSpiciness: spiciness,
                        originalSpiciness: selectedNoodle.spicyLevel
                    };
                    
                    return {
                        menu: adjustedNoodle,
                        extraMenus: [selectedSalad, selectedSide],
                        totalPrice: totalPrice,
                        comment: generateLuxuryComment(adjustedNoodle, selectedSalad, selectedSide, selections),
                        allergyWarning: generateAllergyWarning(adjustedNoodle, allergies)
                    };
                }
            }
            
            // ÊôÆÈÄö‰∫àÁÆó„ÅÆÂ†¥Âêà„ÅÆÂá¶ÁêÜÔºàÊãÖ„ÄÖÈ∫∫„Åæ„Åü„ÅØÊπØÈ∫∫„Åã„Çâ1ÂìÅÔºâ
            if (selections.budget === 'normal') {
                // ÊãÖ„ÄÖÈ∫∫„Åæ„Åü„ÅØÊπØÈ∫∫„Åã„ÇâÈÅ∏Êäû
                const noodleMenus = [...menuDatabase.tantanmen, ...menuDatabase.yunmen].filter(menu => 
                    !allergies.some(allergen => menu.allergens.includes(allergen)) &&
                    menu.price <= budget.max
                );
                
                if (noodleMenus.length > 0) {
                    // Ëæõ„Åï„É¨„Éô„É´„Å´ÈÅ©„Åó„Åü„É°„Éã„É•„Éº„ÇíÂÑ™ÂÖàÈÅ∏Êäû
                    let suitableNoodles = noodleMenus.filter(menu => {
                        if (menu.spicyLevel === 0) return true; // Ëæõ„Åè„Å™„ÅÑ„É°„Éã„É•„Éº„ÅØÂ∏∏„Å´ÈÅ©Áî®
                        return Math.abs(menu.spicyLevel - spiciness) <= 1; // ¬±1„É¨„Éô„É´„Åæ„ÅßË®±ÂÆπ
                    });
                    if (suitableNoodles.length === 0) suitableNoodles = noodleMenus;
                    
                    const selectedNoodle = suitableNoodles[Math.floor(Math.random() * suitableNoodles.length)];
                    
                    // Ëæõ„ÅïË™øÊï¥
                    const adjustedMenu = {
                        ...selectedNoodle,
                        adjustedSpiciness: spiciness,
                        originalSpiciness: selectedNoodle.spicyLevel
                    };
                    
                    return {
                        menu: adjustedMenu,
                        comment: generateComment(adjustedMenu, selections),
                        allergyWarning: generateAllergyWarning(adjustedMenu, allergies)
                    };
                }
            }
            
            // Êéß„Åà„ÇÅ‰∫àÁÆó„ÅÆÂ†¥Âêà„ÅÆÂá¶ÁêÜÔºà„Çµ„Ç§„Éâ„É°„Éã„É•„Éº„Åæ„Åü„ÅØ„Çµ„É©„ÉÄ„Åã„ÇâÈÅ∏ÊäûÔºâ
            if (selections.budget === 'light') {
                // „Çµ„É©„ÉÄ„Åæ„Åü„ÅØ„Çµ„Ç§„Éâ„É°„Éã„É•„Éº„Åã„Çâ600ÂÜÜ‰ª•‰∏ã„ÅÆ„É°„Éã„É•„Éº„ÇíÈÅ∏Êäû
                const lightMenus = [...menuDatabase.salads, ...menuDatabase.sides].filter(menu => 
                    !allergies.some(allergen => menu.allergens.includes(allergen)) &&
                    menu.price <= 600
                );
                
                if (lightMenus.length > 0) {
                    // Ê∞óÂàÜ„Å´Âøú„Åò„ÅüÈÅ∏Êäû
                    let filteredMenus;
                    if (mood === 'healthy') {
                        // „ÅÇ„Å£„Åï„ÇäÁ≥ªÔºö„Çµ„É©„ÉÄ„ÇíÂÑ™ÂÖà
                        filteredMenus = lightMenus.filter(menu => menu.category === 'salad');
                        if (filteredMenus.length === 0) filteredMenus = lightMenus;
                    } else if (mood === 'hearty') {
                        // „Åå„Å£„Å§„ÇäÁ≥ªÔºö„Çµ„Ç§„Éâ„É°„Éã„É•„Éº„ÇíÂÑ™ÂÖà
                        filteredMenus = lightMenus.filter(menu => menu.category === 'side');
                        if (filteredMenus.length === 0) filteredMenus = lightMenus;
                    } else {
                        filteredMenus = lightMenus;
                    }
                    
                    const selectedMenu = filteredMenus[Math.floor(Math.random() * filteredMenus.length)];
                    
                    return {
                        menu: selectedMenu,
                        comment: generateLightBudgetComment(selectedMenu, selections),
                        allergyWarning: generateAllergyWarning(selectedMenu, allergies)
                    };
                }
            }
            
            // „Åù„ÅÆ‰ªñ„ÅÆ‰∫àÁÆó„Åß„ÅÆÊ∞óÂàÜ„Å´Âøú„Åò„Åü„É°„Éã„É•„ÉºÈÅ∏Êäû
            let selectedMenu;
            if (mood === 'hearty') {
                // „Åå„Å£„Å§„ÇäÁ≥ªÔºö„ÉÅ„É£„Éº„Ç∑„É•„ÉºÊãÖ„ÄÖÈ∫∫„ÄÅ„Çª„ÉÉ„Éà„É°„Éã„É•„Éº„ÇíÂÑ™ÂÖà
                const heartyMenus = availableMenus.filter(menu => 
                    menu.name.includes('„ÉÅ„É£„Éº„Ç∑„É•„Éº') || 
                    menu.name.includes('„Çª„ÉÉ„Éà') || 
                    menu.category === 'tantanmen'
                );
                selectedMenu = heartyMenus.length > 0 ? 
                    heartyMenus[Math.floor(Math.random() * heartyMenus.length)] :
                    availableMenus[Math.floor(Math.random() * availableMenus.length)];
            } else if (mood === 'healthy') {
                // „ÅÇ„Å£„Åï„ÇäÁ≥ªÔºö„Çµ„É©„ÉÄ„ÄÅÊπØÈ∫∫„ÇíÂÑ™ÂÖà
                const healthyMenus = availableMenus.filter(menu => 
                    menu.category === 'salad' || 
                    menu.category === 'yunmen' ||
                    menu.name.includes('„Éà„Éû„Éà')
                );
                selectedMenu = healthyMenus.length > 0 ? 
                    healthyMenus[Math.floor(Math.random() * healthyMenus.length)] :
                    availableMenus[Math.floor(Math.random() * availableMenus.length)];
            } else {
                // ÈÄöÂ∏∏ÈÅ∏Êäû
                selectedMenu = availableMenus[Math.floor(Math.random() * availableMenus.length)];
            }
            
            // Ëæõ„ÅïË™øÊï¥
            const adjustedMenu = {
                ...selectedMenu,
                adjustedSpiciness: spiciness,
                originalSpiciness: selectedMenu.spicyLevel
            };
            
            return {
                menu: adjustedMenu,
                comment: generateComment(adjustedMenu, selections),
                allergyWarning: generateAllergyWarning(adjustedMenu, allergies)
            };
        }

        function getBudgetRange(budget) {
            switch(budget) {
                case 'luxury': return {max: 1500, min: 1200};
                case 'normal': return {max: 1200, min: 800};
                case 'light': return {max: 800, min: 600};
                default: return {max: 1000, min: 700};
            }
        }

        function generateComment(menu, selections) {
            const comments = [];
            
            // ÂêçÁâ©„É°„Éã„É•„Éº„ÅÆÂ†¥Âêà
            if (menu.isSignature) {
                comments.push('„Çâ„Çì„Å¶„Çì„ÅÆÂêçÁâ©„É°„Éã„É•„Éº„Åß„ÅôÔºÅ„Éü„Ç∑„É•„É©„É≥„Ç¨„Ç§„ÉâÊé≤Ëºâ„Ç∑„Çß„Éï„ÅÆÊäÄ„Çí„ÅîÂ†™ËÉΩ„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return comments[0];
            }
            
            // ‰∫àÁÆóÂà•„Ç≥„É°„É≥„Éà
            if (selections.budget === 'luxury') {
                comments.push('‰ªäÊó•„ÅØÁâπÂà•„Å™Êó•ÔºÅ„Çâ„Çì„Å¶„Çì„ÅÆ‰∏ÄÁï™Ë¥ÖÊ≤¢„Å™„É°„Éã„É•„Éº„ÅØ„ÅÑ„Åã„ÅåÔºü');
            } else if (selections.budget === 'normal') {
                comments.push('„Çâ„Çì„Å¶„Çì„ÅÆÂÆöÁï™„ÄÅÊãÖ„ÄÖÈ∫∫„ÅÆÁæéÂë≥„Åó„Åï„Çí„Åó„Å£„Åã„ÇäÂë≥„Çè„Åà„Åæ„Åô');
            } else {
                comments.push('„Éò„É´„Ç∑„Éº„Å´Ê±∫„ÇÅ„Çã„Å™„Çâ„ÄÅÊñ∞ÈÆÆ„Çµ„É©„ÉÄ„Åå„Åä„Åô„Åô„ÇÅÔºÅ');
            }
            
            // Ëæõ„ÅïÂà•„Ç≥„É°„É≥„Éà
            if (selections.spiciness <= 2) {
                comments.push('Ëæõ„ÅÑ„ÅÆ„ÅåËã¶Êâã„Å™Êñπ„ÇÇÂÆâÂøÉ„ÄÅ„Åæ„Çç„ÇÑ„Åã„Å™ÊãÖ„ÄÖÈ∫∫„Åß„Åô');
            } else if (selections.spiciness === 3) {
                comments.push('„Çâ„Çì„Å¶„Çì„ÅÆÂü∫Êú¨„ÅÆËæõ„Åï„ÄÅËÉ°È∫ª„ÅÆÈ¢®Âë≥„ÅåÈöõÁ´ã„Å°„Åæ„Åô');
            } else {
                comments.push('ËæõÂÖö„ÅÆÊñπÂøÖË¶ãÔºÅÊú¨Ê†ºÂõõÂ∑ù„ÅÆÂà∫ÊøÄ„Çí„ÅîÂ†™ËÉΩ„Åè„Å†„Åï„ÅÑ');
            }
            
            // „Ç¢„É¨„É´„ÇÆ„ÉºÂØæÂøú„Ç≥„É°„É≥„Éà
            if (selections.allergies.length > 0) {
                comments.push('„Ç¢„É¨„É´„ÇÆ„Éº„Å´ÈÖçÊÖÆ„Åó„ÅüÂÆâÂøÉ„É°„Éã„É•„Éº„Çí„ÅîÊèêÊ°à„Åó„Åæ„Åó„Åü');
            } else {
                comments.push('„Ç¢„É¨„É´„ÇÆ„Éº„ÅÆÂøÉÈÖç„Å™„Åè„ÄÅ„ÅäÂ•Ω„Åç„Å™„É°„Éã„É•„Éº„Çí„Å©„ÅÜ„ÅûÔºÅ');
            }
            
            // Ê∞óÂàÜÂà•„Ç≥„É°„É≥„Éà
            if (selections.mood === 'hearty') {
                comments.push('„ÉÅ„É£„Éº„Ç∑„É•„Éº„Åü„Å£„Å∑„ÇäÔºÅÊ∫ÄËÖπÈñìÈÅï„ÅÑ„Å™„Åó„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ');
            } else if (selections.mood === 'healthy') {
                comments.push('ÈáéËèú„Åü„Å£„Å∑„Çä„Åß„Éò„É´„Ç∑„Éº„ÄÅ‰Ωì„Å´ÂÑ™„Åó„ÅÑ„É°„Éã„É•„Éº„Åß„Åô');
            }
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function generateLuxuryComment(noodle, salad, side, selections) {
            const comments = [
                'Ë¥ÖÊ≤¢„Å™3ÂìÅ„Çª„ÉÉ„Éà„ÅßÁâπÂà•„Å™„ÅäÈ£ü‰∫ã„Çí„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑÔºÅ',
                '„Çâ„Çì„Å¶„ÇìËá™ÊÖ¢„ÅÆ„Ç≥„Éº„ÇπÊñôÁêÜ„Çπ„Çø„Ç§„É´„Åß„ÅîÊèê‰æõ„ÅÑ„Åü„Åó„Åæ„Åô',
                'È∫∫„Éª„Çµ„É©„ÉÄ„Éª„Çµ„Ç§„Éâ„ÅÆÁµ∂Â¶ô„Å™„Éê„É©„É≥„Çπ„ÅåËá™ÊÖ¢„ÅÆ„Çª„ÉÉ„Éà„Åß„Åô',
                '‰ªäÊó•„ÅØÁâπÂà•ÔºÅ„Çâ„Çì„Å¶„Çì„ÅÆÁæéÂë≥„Åó„Åï„ÇíÂ≠òÂàÜ„Å´Âë≥„Çè„Åà„Çã„Çª„ÉÉ„Éà„É°„Éã„É•„Éº'
            ];
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function generateLightBudgetComment(menu, selections) {
            const comments = [];
            
            // „É°„Éã„É•„ÉºÁ®ÆÈ°ûÂà•„Ç≥„É°„É≥„Éà
            if (menu.category === 'salad') {
                comments.push('„Éò„É´„Ç∑„Éº„ÅßÊñ∞ÈÆÆ„Å™„Çµ„É©„ÉÄ„Çí„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑÔºÅ');
                comments.push('ÈáéËèú„Åü„Å£„Å∑„Çä„Åß‰Ωì„Å´ÂÑ™„Åó„ÅÑ„É°„Éã„É•„Éº„Åß„Åô');
                comments.push('„É™„Éº„Ç∫„Éä„Éñ„É´„Åß„ÇÇÊ∫ÄË∂≥ÊÑü„ÅÆ„ÅÇ„Çã„Çµ„É©„ÉÄ„Åß„Åô');
            } else if (menu.category === 'side') {
                comments.push('„ÅäÊâãËªΩ‰æ°Ê†º„ÅßÁæéÂë≥„Åó„ÅÑ„Çµ„Ç§„Éâ„É°„Éã„É•„Éº„Åß„ÅôÔºÅ');
                comments.push('Â∞èËÖπ„ÅåÁ©∫„ÅÑ„ÅüÊôÇ„Å´„Å¥„Å£„Åü„Çä„ÅÆ‰∏ÄÂìÅ');
                comments.push('Êéß„Åà„ÇÅ‰∫àÁÆó„Åß„ÇÇÊ∫ÄË∂≥„ÅÑ„Åü„Å†„Åë„Çã„É°„Éã„É•„Éº„Åß„Åô');
            }
            
            // Ê∞óÂàÜÂà•„Ç≥„É°„É≥„Éà
            if (selections.mood === 'healthy') {
                comments.push('„ÅÇ„Å£„Åï„Çä„Éò„É´„Ç∑„Éº„ÅßÂçàÂæå„ÇÇ„Åô„Å£„Åç„Çä');
            } else if (selections.mood === 'hearty') {
                comments.push('Â∞è„Åï„Åè„Å¶„ÇÇÊ∫ÄË∂≥ÊÑü„ÅÆ„ÅÇ„Çã‰∏ÄÂìÅ„Åß„Åô');
            }
            
            // „Ç¢„É¨„É´„ÇÆ„ÉºÂØæÂøú„Ç≥„É°„É≥„Éà
            if (selections.allergies.length > 0) {
                comments.push('„Ç¢„É¨„É´„ÇÆ„Éº„Å´ÈÖçÊÖÆ„Åó„ÅüÂÆâÂøÉ„É°„Éã„É•„Éº„Åß„Åô');
            }
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function generateAllergyWarning(menu, userAllergies) {
            if (userAllergies.length === 0) return null;
            
            const menuAllergens = menu.allergens || [];
            const commonAllergens = menuAllergens.filter(allergen => 
                !userAllergies.includes(allergen)
            );
            
            if (menuAllergens.length > 0) {
                return `„Åì„ÅÆ„É°„Éã„É•„Éº„Å´Âê´„Åæ„Çå„Çã„Ç¢„É¨„É´„Ç≤„É≥: ${menuAllergens.join('„ÄÅ')}`;
            }
            
            return null;
        }

        function createFallbackSuggestion(budget, allergies) {
            // „Ç¢„É¨„É´„ÇÆ„ÉºÂØæÂøú„ÅÆÂÆâÂÖ®„Å™„É°„Éã„É•„Éº„ÇíÊèêÊ°à
            const safeMenus = menuDatabase.salads.filter(menu => 
                menu.allergens.length === 0 && menu.price <= budget.max
            );
            
            if (safeMenus.length > 0) {
                return {
                    menu: safeMenus[0],
                    comment: '„Ç¢„É¨„É´„ÇÆ„Éº„Å´ÈÖçÊÖÆ„Åó„ÅüÂÆâÂÖ®„Å™„É°„Éã„É•„Éº„Çí„ÅäÈÅ∏„Å≥„Åó„Åæ„Åó„Åü„ÄÇ',
                    allergyWarning: null
                };
            }
            
            return {
                menu: {
                    name: '„Çπ„Çø„ÉÉ„Éï„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ',
                    price: 0,
                    description: '„ÅäÂÆ¢Êßò„ÅÆ„Ç¢„É¨„É´„ÇÆ„ÉºÊÉÖÂ†±„ÇíËÄÉÊÖÆ„Åó„ÅüÁâπÂà•„É°„Éã„É•„Éº„Çí„ÅîÊèêÊ°à„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ'
                },
                comment: '„ÅäÂÆ¢Êßò„ÅÆ„ÅîË¶ÅÊúõ„Å´Âêà„Çè„Åõ„Å¶„Çπ„Çø„ÉÉ„Éï„ÅåÂÄãÂà•„Å´„ÅîÊèêÊ°à„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ',
                allergyWarning: null
            };
        }

        function displaySuggestion(suggestion) {
            const menuItems = document.getElementById('menu-items');
            const commentText = document.getElementById('comment-text');
            const allergyWarning = document.getElementById('allergy-warning');
            const allergyWarningText = document.getElementById('allergy-warning-text');
            
            menuItems.innerHTML = '';
            
            const menu = suggestion.menu;
            let totalPrice = menu.price;
            
            // „É°„Ç§„É≥„É°„Éã„É•„Éº„ÇíË°®Á§∫
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item';
            
            let spicyIndicator = '';
            if (menu.adjustedSpiciness && menu.adjustedSpiciness > 0) {
                const spicyLevel = menuDatabase.spicyLevels[menu.adjustedSpiciness];
                spicyIndicator = ` (Ëæõ„Åï${menu.adjustedSpiciness}: ${spicyLevel.name})`;
            }
            
            let signatureBadge = '';
            if (menu.isSignature) {
                signatureBadge = '<span class="signature-badge">ÂêçÁâ©</span>';
            }
            
            menuItem.innerHTML = `
                <div class="menu-name">üçú ${menu.name}${spicyIndicator}${signatureBadge}</div>
                <div class="menu-price">${menu.price}ÂÜÜ</div>
            `;
            menuItems.appendChild(menuItem);
            
            // „Ç®„ÇØ„Çπ„Éà„É©„É°„Éã„É•„ÉºÔºà„Çµ„É©„ÉÄÔºâ„Åå„ÅÇ„ÇãÂ†¥Âêà
            if (suggestion.extraMenu) {
                const extraItem = document.createElement('div');
                extraItem.className = 'menu-item';
                extraItem.innerHTML = `
                    <div class="menu-name">ü•ó ${suggestion.extraMenu.name}</div>
                    <div class="menu-price">${suggestion.extraMenu.price}ÂÜÜ</div>
                `;
                menuItems.appendChild(extraItem);
                totalPrice += suggestion.extraMenu.price;
            }
            
            // Ë¥ÖÊ≤¢„Çª„ÉÉ„Éà„ÅÆË§áÊï∞„Ç®„ÇØ„Çπ„Éà„É©„É°„Éã„É•„Éº„Åå„ÅÇ„ÇãÂ†¥Âêà
            if (suggestion.extraMenus) {
                suggestion.extraMenus.forEach((extraMenu, index) => {
                    const extraItem = document.createElement('div');
                    extraItem.className = 'menu-item';
                    const icon = index === 0 ? 'ü•ó' : 'üçΩÔ∏è';
                    extraItem.innerHTML = `
                        <div class="menu-name">${icon} ${extraMenu.name}</div>
                        <div class="menu-price">${extraMenu.price}ÂÜÜ</div>
                    `;
                    menuItems.appendChild(extraItem);
                    totalPrice += extraMenu.price;
                });
            }
            
            // ÂêàË®àÈáëÈ°ç„ÇíË°®Á§∫
            const totalItem = document.createElement('div');
            totalItem.className = 'menu-item';
            const finalPrice = suggestion.totalPrice || totalPrice;
            totalItem.innerHTML = `
                <div class="menu-name">üí∞ ÂêàË®àÈáëÈ°ç</div>
                <div class="menu-price">${finalPrice}ÂÜÜ</div>
            `;
            menuItems.appendChild(totalItem);
            
            commentText.textContent = suggestion.comment;
            
            if (suggestion.allergyWarning) {
                allergyWarningText.textContent = suggestion.allergyWarning;
                allergyWarning.style.display = 'block';
            } else {
                allergyWarning.style.display = 'none';
            }
        }

        function adjustSpiciness(adjustment) {
            if (!currentSuggestion || !currentSuggestion.menu) return;
            
            const currentLevel = currentSuggestion.menu.adjustedSpiciness || currentSuggestion.menu.spicyLevel;
            const newLevel = Math.max(1, Math.min(5, currentLevel + adjustment));
            
            if (newLevel !== currentLevel) {
                currentSuggestion.menu.adjustedSpiciness = newLevel;
                
                // Ëæõ„Åï„É¨„Éô„É´„Å´Âøú„Åò„Åü„Ç≥„É°„É≥„ÉàÊõ¥Êñ∞
                const spicyLevel = menuDatabase.spicyLevels[newLevel];
                if (adjustment > 0) {
                    currentSuggestion.comment = `Ëæõ„Åï„Çí${newLevel}„Å´Ë™øÊï¥„Åó„Åæ„Åó„Åü„ÄÇ${spicyLevel.description}`;
                } else if (adjustment < 0) {
                    currentSuggestion.comment = `Ëæõ„Åï„Çí${newLevel}„Å´Ë™øÊï¥„Åó„Åæ„Åó„Åü„ÄÇ${spicyLevel.description}`;
                } else {
                    currentSuggestion.comment = `Ê®ôÊ∫ñ„ÅÆËæõ„ÅïÔºà„É¨„Éô„É´${newLevel}Ôºâ„Åß„Åô„ÄÇ${spicyLevel.description}`;
                }
                
                displaySuggestion(currentSuggestion);
            }
        }

        function displayFinalDecision() {
            if (!currentSuggestion) return;
            
            const finalMenuItems = document.getElementById('final-menu-items');
            const finalCommentText = document.getElementById('final-comment-text');
            
            finalMenuItems.innerHTML = '';
            
            const menu = currentSuggestion.menu;
            let totalPrice = menu.price;
            
            // „É°„Ç§„É≥„É°„Éã„É•„Éº„ÇíË°®Á§∫
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item';
            
            let spicyIndicator = '';
            if (menu.adjustedSpiciness && menu.adjustedSpiciness > 0) {
                const spicyLevel = menuDatabase.spicyLevels[menu.adjustedSpiciness];
                spicyIndicator = ` (Ëæõ„Åï${menu.adjustedSpiciness}: ${spicyLevel.name})`;
            }
            
            let signatureBadge = '';
            if (menu.isSignature) {
                signatureBadge = '<span class="signature-badge">ÂêçÁâ©</span>';
            }
            
            menuItem.innerHTML = `
                <div class="menu-name">üçú ${menu.name}${spicyIndicator}${signatureBadge}</div>
                <div class="menu-price">${menu.price}ÂÜÜ</div>
            `;
            finalMenuItems.appendChild(menuItem);
            
            // „Ç®„ÇØ„Çπ„Éà„É©„É°„Éã„É•„ÉºÔºà„Çµ„É©„ÉÄÔºâ„Åå„ÅÇ„ÇãÂ†¥Âêà
            if (currentSuggestion.extraMenu) {
                const extraItem = document.createElement('div');
                extraItem.className = 'menu-item';
                extraItem.innerHTML = `
                    <div class="menu-name">ü•ó ${currentSuggestion.extraMenu.name}</div>
                    <div class="menu-price">${currentSuggestion.extraMenu.price}ÂÜÜ</div>
                `;
                finalMenuItems.appendChild(extraItem);
                totalPrice += currentSuggestion.extraMenu.price;
            }
            
            // Ë¥ÖÊ≤¢„Çª„ÉÉ„Éà„ÅÆË§áÊï∞„Ç®„ÇØ„Çπ„Éà„É©„É°„Éã„É•„Éº„Åå„ÅÇ„ÇãÂ†¥Âêà
            if (currentSuggestion.extraMenus) {
                currentSuggestion.extraMenus.forEach((extraMenu, index) => {
                    const extraItem = document.createElement('div');
                    extraItem.className = 'menu-item';
                    const icon = index === 0 ? 'ü•ó' : 'üçΩÔ∏è';
                    extraItem.innerHTML = `
                        <div class="menu-name">${icon} ${extraMenu.name}</div>
                        <div class="menu-price">${extraMenu.price}ÂÜÜ</div>
                    `;
                    finalMenuItems.appendChild(extraItem);
                    totalPrice += extraMenu.price;
                });
            }
            
            // ÂêàË®àÈáëÈ°ç„ÇíË°®Á§∫
            const totalItem = document.createElement('div');
            totalItem.className = 'menu-item';
            const finalPrice = currentSuggestion.totalPrice || totalPrice;
            totalItem.innerHTML = `
                <div class="menu-name">üí∞ ÂêàË®àÈáëÈ°ç</div>
                <div class="menu-price">${finalPrice}ÂÜÜ</div>
            `;
            finalMenuItems.appendChild(totalItem);
            
            finalCommentText.textContent = `„Çâ„Çì„Å¶„Çì„Åß„ÅÆÁ¥†Êïµ„Å™„ÅäÈ£ü‰∫ã„Çí„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑÔºÅ${currentSuggestion.comment}`;
        }

        function finalDecision() {
            displayFinalDecision();
            showFinalScreen();
        }

        function showResultScreen() {
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-screen').style.display = 'none';
        }

        function showFinalScreen() {
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('final-screen').style.display = 'block';
        }

        function goBack() {
            document.getElementById('selection-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('final-screen').style.display = 'none';
        }

        function restart() {
            // ÈÅ∏ÊäûÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            selections = {budget: null, spiciness: null, allergies: [], mood: null};
            
            // „Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.choice-btn, .spicy-btn, .allergy-btn, .optional-btn, .no-allergy-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ÊèêÊ°à„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
            document.getElementById('submit-btn').disabled = true;
            
            // ÊúÄÂàù„ÅÆÁîªÈù¢„ÇíË°®Á§∫
            goBack();
        }

        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÂÖ¨Èñã
        window.adjustSpiciness = adjustSpiciness;
        window.finalDecision = finalDecision;
        window.goBack = goBack;
        window.restart = restart;
    </script>
</body>
</html>