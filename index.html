<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MenuMate - æ‹…ã€…éººã¨ã‚µãƒ©ãƒ€ã®åº—ã‚‰ã‚“ã¦ã‚“å°‚ç”¨ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: 
                linear-gradient(135deg, rgba(231, 199, 199, 0.3) 0%, rgba(122, 106, 106, 0.2) 50%, rgba(255,255,255,0.4) 100%),
                url('èƒŒæ™¯ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼”å“.png') center/cover no-repeat;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #d63031, #000000);
            padding: 5px 10px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 40px;
        }

        .header p {
            font-size: 15px;
            opacity: 0.9;
        }

        .content {
            padding: 30px 20px;
        }

        .question {
            margin-bottom: 30px;
        }

        .question h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .required {
            color: #d63031;
            font-size: 12px;
            font-weight: normal;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* æ¥åº—ã‚¿ã‚¤ãƒ—ç”¨ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .button-group:first-of-type {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 10px;
        }

        /* ï¼’å›ä»¥ä¸Šæ¥åº—ãƒœã‚¿ãƒ³ã‚’ä¸‹æ®µã«é…ç½® */
        .button-group:first-of-type .choice-btn:last-child {
            grid-column: 1 / -1;
        }

        /* è¾›ã•é¸æŠç”¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .spicy-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 8px;
        }

        .spicy-group .choice-btn {
            font-size: 12px;
            padding: 12px 8px;
            min-width: 60px;
        }

        /* è¾›å£ã¨å¤§è¾›ä»¥ä¸Šã‚’ä¸‹æ®µã«é…ç½® */
        .spicy-group .choice-btn:nth-child(4) {
            grid-column: 2 / 3;
            grid-row: 2;
        }

        .spicy-group .choice-btn:last-child {
            grid-column: 3 / 4;
            grid-row: 2;
        }

        /* æ°—åˆ†é¸æŠç”¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .button-group.mood-group {
            display: flex !important;
            flex-direction: column !important;
            gap: 10px !important;
            flex-wrap: nowrap !important;
        }

        .button-group.mood-group .optional-btn {
            width: 100% !important;
            flex: none !important;
        }

        .choice-btn {
            flex: 1;
            padding: 15px 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .choice-btn.selected {
            background: #d63031;
            color: white;
            border-color: #d63031;
        }


        .allergy-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .allergy-btn {
            padding: 12px 8px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .allergy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .allergy-btn.selected {
            background: #fdcb6e;
            color: white;
            border-color: #fdcb6e;
        }

        .no-allergy-btn {
            width: 100%;
            padding: 12px;
            border: 2px solid #00b894;
            background: white;
            color: #00b894;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .no-allergy-btn:hover {
            background: #00b894;
            color: white;
        }

        .no-allergy-btn.selected {
            background: #00b894;
            color: white;
        }

        .optional-btn {
            width: 100%;
            padding: 15px;
            border: 2px dashed #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .optional-btn:hover {
            background: #fff3cd;
            border-color: #feca57;
        }

        .optional-btn.selected {
            background: #feca57;
            color: white;
            border-color: #feca57;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #d63031, #000000);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            display: none;
        }

        .result-card {
            background: linear-gradient(135deg, #f82258, #f83b3b);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: white;
        }

        .result-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .result-header h3 {
            color: white;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        .menu-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid rgba(255,255,255,0.5);
        }

        .menu-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .menu-price {
            font-weight: bold;
            color: white;
        }

        .signature-badge {
            background: #feca57;
            color: #333;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 8px;
        }

        .comment {
            background: #fff3cd;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #feca57;
        }

        .comment p {
            color: #333;
            font-size: 16px;
            line-height: 1.5;
        }

        .allergy-warning {
            background: #ffebe6;
            border: 2px solid #ff7675;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }

        .allergy-warning h4 {
            color: #d63031;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .allergy-warning p {
            color: #333;
            font-size: 13px;
            line-height: 1.4;
        }

        .spicy-adjust {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .spicy-adjust h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .spicy-adjust-buttons {
            display: flex;
            gap: 10px;
        }

        .spicy-adjust-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .spicy-adjust-btn:hover {
            background: #ff7675;
            color: white;
            border-color: #ff7675;
        }

        .final-btn {
            width: 100%;
            padding: 18px;
            background: #00b894;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .final-btn:hover {
            background: #00a085;
            transform: translateY(-2px);
        }

        .back-btn {
            width: 100%;
            padding: 15px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .back-btn:hover {
            background: #545b62;
        }

        @media (max-width: 480px) {
            .container {
                margin: 10px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .choice-btn {
                min-width: 100%;
            }

            .allergy-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸœ MenuMate</h1>
            <img src="ã‚‰ã‚“ã¦ã‚“ãƒ­ã‚´ã‚«ãƒƒãƒˆ.png" alt="ã‚‰ã‚“ã¦ã‚“åº—åãƒ­ã‚´" style="height: 150px; margin: 5px 0; object-fit: contain;">
        </div>

        <div id="selection-screen" class="content">
            <div class="question">
                <h3>ğŸ‘¥ ã”æ¥åº—ã‚¿ã‚¤ãƒ—ã‚’ãŠé¸ã³ãã ã•ã„ <span class="required">â€»å¿…é ˆ</span></h3>
                <div class="button-group">
                    <button class="choice-btn" data-visitor-type="first-male">åˆã‚ã¦ã®æ–¹<br><small>ï¼ˆç”·æ€§ï¼‰</small></button>
                    <button class="choice-btn" data-visitor-type="first-female">åˆã‚ã¦ã®æ–¹<br><small>ï¼ˆå¥³æ€§ï¼‰</small></button>
                    <button class="choice-btn" data-visitor-type="with-kids">ãŠå­æ§˜é€£ã‚Œ<br><small>ã®æ–¹</small></button>
                    <button class="choice-btn" data-visitor-type="returning">ï¼’å›ä»¥ä¸Šæ¥åº—<br><small></small></button>
                </div>
            </div>

            <div class="question">
                <h3>ğŸŒ¶ï¸ è¾›ã•ã®å¥½ã¿ã‚’ãŠé¸ã³ãã ã•ã„ <span class="required">â€»å¿…é ˆ</span></h3>
                <div class="button-group spicy-group">
                    <button class="choice-btn" data-spicy="0">è¾›ã•ãªã—<br><small>1</small></button>
                    <button class="choice-btn" data-spicy="2">ã²ã‹ãˆã‚<br><small>2</small></button>
                    <button class="choice-btn" data-spicy="3">ãµã¤ã†<br><small>3</small></button>
                    <button class="choice-btn" data-spicy="4">è¾›å£<br><small>4</small></button>
                    <button class="choice-btn" data-spicy="5">å¤§è¾›ä»¥ä¸Š<br><small>5</small></button>
                </div>
            </div>

            <div class="question">
                <h3>âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒã‚ã‚‹ã‚‚ã®ã‚’é¸ã‚“ã§ãã ã•ã„ <span class="required">â€»å¿…é ˆ</span></h3>
                <div class="allergy-grid">
                    <button class="allergy-btn" data-allergy="å°éº¦">å°éº¦</button>
                    <button class="allergy-btn" data-allergy="å¤§è±†">å¤§è±†</button>
                    <button class="allergy-btn" data-allergy="åµ">åµ</button>
                    <button class="allergy-btn" data-allergy="ä¹³è£½å“">ä¹³è£½å“</button>
                    <button class="allergy-btn" data-allergy="ã”ã¾">ã”ã¾</button>
                    <button class="allergy-btn" data-allergy="ãˆã³">ãˆã³</button>
                    <button class="allergy-btn" data-allergy="é¶è‚‰">é¶è‚‰</button>
                    <button class="allergy-btn" data-allergy="è±šè‚‰">è±šè‚‰</button>
                </div>
                <button class="no-allergy-btn" id="no-allergy-btn">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãªã—</button>
            </div>

            <div class="question">
                <h3>âœ¨ ä»Šæ—¥ã®æ°—åˆ†ã¯ï¼Ÿ</h3>
                <div class="button-group mood-group">
                    <button class="optional-btn" data-mood="hearty">ãŒã£ã¤ã‚Šç³»<br><small>æº€è…¹é‡è¦–</small></button>
                    <button class="optional-btn" data-mood="healthy">ã‚ã£ã•ã‚Šç³»<br><small>ãƒ˜ãƒ«ã‚·ãƒ¼é‡è¦–</small></button>
                </div>
            </div>

            <button id="submit-btn" class="submit-btn" disabled>ğŸ¯ ãŠã™ã™ã‚ã‚’æ•™ãˆã¦ï¼</button>
        </div>

        <div id="result-screen" class="content result">
            <div class="result-card">
                <div class="result-header">
                    <h3>ğŸ’¡ ã‚‰ã‚“ã¦ã‚“MenuMateã‹ã‚‰ã®ææ¡ˆ</h3>
                </div>
                <div id="menu-items"></div>
            </div>

            <div class="comment">
                <p id="comment-text"></p>
            </div>

            <div id="allergy-warning" class="allergy-warning" style="display: none;">
                <h4>âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±</h4>
                <p id="allergy-warning-text"></p>
            </div>

            <div class="spicy-adjust">
                <h4>ğŸŒ¶ï¸ è¾›ã•èª¿æ•´</h4>
                <div class="spicy-adjust-buttons">
                    <button class="spicy-adjust-btn" onclick="adjustSpiciness(-1)">ã‚ˆã‚Šå¼±ã</button>
                    <button class="spicy-adjust-btn" onclick="adjustSpiciness(0)">ã“ã®ã¾ã¾</button>
                    <button class="spicy-adjust-btn" onclick="adjustSpiciness(1)">ã‚ˆã‚Šè¾›ã</button>
                </div>
            </div>

            <button class="final-btn" onclick="finalDecision()">âœ… ã“ã‚Œã§æ³¨æ–‡ã—ã¾ã™ï¼</button>
            <button class="back-btn" onclick="goBack()">â† æœ€åˆã‹ã‚‰é¸ã³ç›´ã™</button>
        </div>

        <div id="final-screen" class="content result">
            <div class="result-header" style="text-align: center; margin-bottom: 30px;">
                <h3>ğŸ‰ ç´ æ•µãªãŠé£Ÿäº‹ã‚’<br>ãŠæ¥½ã—ã¿ãã ã•ã„ ğŸ‰</h3>
            </div>
            
            <div class="result-card">
                <div class="result-header">
                    <h3>ğŸ“‹ ã”æ³¨æ–‡å†…å®¹</h3>
                </div>
                <div id="final-menu-items"></div>
            </div>

            <div class="comment">
                <p id="final-comment-text"></p>
            </div>
            
            <button class="back-btn" onclick="restart()">â† æ–°ã—ãé¸ã¶</button>
        </div>
    </div>

    <script type="module">
        import menuDatabase from './src/menuDatabase.js';

        // é¸æŠçŠ¶æ…‹
        let selections = {
            visitorType: null,
            spiciness: null,
            allergies: [],
            mood: null
        };

        let currentSuggestion = null;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // æ¥åº—ã‚¿ã‚¤ãƒ—é¸æŠãƒœã‚¿ãƒ³
            document.querySelectorAll('[data-visitor-type]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-visitor-type]').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selections.visitorType = this.dataset.visitorType;
                    checkSubmitButton();
                });
            });

            // è¾›ã•é¸æŠãƒœã‚¿ãƒ³
            document.querySelectorAll('[data-spicy]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-spicy]').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selections.spiciness = parseInt(this.dataset.spicy);
                    checkSubmitButton();
                });
            });

            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼é¸æŠãƒœã‚¿ãƒ³
            document.querySelectorAll('[data-allergy]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const allergy = this.dataset.allergy;
                    
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selections.allergies = selections.allergies.filter(a => a !== allergy);
                    } else {
                        this.classList.add('selected');
                        selections.allergies.push(allergy);
                        // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã‚ã‚Šã‚’é¸æŠã—ãŸå ´åˆã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãªã—ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                        document.getElementById('no-allergy-btn').classList.remove('selected');
                    }
                    checkSubmitButton();
                });
            });

            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãªã—ãƒœã‚¿ãƒ³
            document.getElementById('no-allergy-btn').addEventListener('click', function() {
                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                } else {
                    this.classList.add('selected');
                    // ä»–ã®ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒœã‚¿ãƒ³ã‚’ã™ã¹ã¦ç„¡åŠ¹åŒ–
                    document.querySelectorAll('[data-allergy]').forEach(btn => btn.classList.remove('selected'));
                    selections.allergies = [];
                }
                checkSubmitButton();
            });

            // æ°—åˆ†ãƒœã‚¿ãƒ³ï¼ˆä»»æ„ï¼‰
            document.querySelectorAll('[data-mood]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-mood]').forEach(b => b.classList.remove('selected'));
                    
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selections.mood = null;
                    } else {
                        this.classList.add('selected');
                        selections.mood = this.dataset.mood;
                    }
                });
            });

            // ææ¡ˆãƒœã‚¿ãƒ³
            document.getElementById('submit-btn').addEventListener('click', function() {
                generateSuggestion();
            });
        }

        function checkSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            const allergySelected = selections.allergies.length > 0 || document.getElementById('no-allergy-btn').classList.contains('selected');
            
            if (selections.visitorType && selections.spiciness !== null && allergySelected) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        function generateSuggestion() {
            const suggestion = createSuggestion(selections);
            currentSuggestion = suggestion;
            displaySuggestion(suggestion);
            showResultScreen();
        }

        function createSuggestion(selections) {
            const visitorType = selections.visitorType;
            const spiciness = selections.spiciness;
            const allergies = selections.allergies;
            const mood = selections.mood;
            
            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å–å¾—
            let availableMenus = menuDatabase.getMenusWithoutAllergens(allergies);
            
            // è¾›ã•ãƒ¬ãƒ™ãƒ«ã«é©ã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å„ªå…ˆ
            let suitableMenus = availableMenus.filter(menu => {
                if (menu.spicyLevel === 0) return true; // è¾›ããªã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯å¸¸ã«é©ç”¨
                return Math.abs(menu.spicyLevel - spiciness) <= 1; // Â±1ãƒ¬ãƒ™ãƒ«ã¾ã§è¨±å®¹
            });
            
            // é©åˆ‡ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒãªã„å ´åˆã¯å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰é¸æŠ
            if (suitableMenus.length === 0) {
                suitableMenus = availableMenus;
            }
            
            // æ¥åº—ã‚¿ã‚¤ãƒ—åˆ¥ã®æ¨è–¦å‡¦ç†
            if (visitorType === 'first-male') {
                // åˆã‚ã¦ã®æ–¹ï¼ˆç”·æ€§ï¼‰: å®šç•ªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§æº€è¶³æ„Ÿé‡è¦–ã€æ‹…ã€…éººã‚’ä¸­å¿ƒ
                return createFirstMaleSuggestion(spiciness, allergies, mood);
            } else if (visitorType === 'first-female') {
                // åˆã‚ã¦ã®æ–¹ï¼ˆå¥³æ€§ï¼‰: ãƒ˜ãƒ«ã‚·ãƒ¼ã§ãƒãƒ©ãƒ³ã‚¹é‡è¦–ã€ã‚µãƒ©ãƒ€ã‚»ãƒƒãƒˆãªã©
                return createFirstFemaleSuggestion(spiciness, allergies, mood);
            } else if (visitorType === 'with-kids') {
                // ãŠå­æ§˜é€£ã‚Œã®æ–¹: è¾›ã•æ§ãˆã‚ã€å–ã‚Šåˆ†ã‘ã—ã‚„ã™ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼
                return createWithKidsSuggestion(spiciness, allergies, mood);
            } else if (visitorType === 'returning') {
                // ï¼’å›ä»¥ä¸Šæ¥åº—: ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼å‘ã‘ã€åç‰©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„å†’é™ºçš„ãªçµ„ã¿åˆã‚ã›
                return createReturningSuggestion(spiciness, allergies, mood);
            }
            
            // å¾“æ¥ã®äºˆç®—åˆ¥å‡¦ç†ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
            if (selections.budget === 'luxury') {
                // æ‹…ã€…éººã¾ãŸã¯æ¹¯éººã‹ã‚‰1å“é¸æŠ
                const noodleMenus = [...menuDatabase.tantanmen, ...menuDatabase.yunmen].filter(menu => 
                    !allergies.some(allergen => menu.allergens.includes(allergen))
                );
                
                // ã‚µãƒ©ãƒ€ã‹ã‚‰1å“é¸æŠ
                const saladMenus = menuDatabase.salads.filter(salad => 
                    !allergies.some(allergen => salad.allergens.includes(allergen))
                );
                
                // ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰1å“é¸æŠ
                const sideMenus = menuDatabase.sides.filter(side => 
                    !allergies.some(allergen => side.allergens.includes(allergen))
                );
                
                if (noodleMenus.length > 0 && saladMenus.length > 0 && sideMenus.length > 0) {
                    // è¾›ã•ãƒ¬ãƒ™ãƒ«ã«é©ã—ãŸéººé¡ã‚’å„ªå…ˆé¸æŠ
                    let suitableNoodles = noodleMenus.filter(menu => {
                        if (menu.spicyLevel === 0) return true;
                        return Math.abs(menu.spicyLevel - spiciness) <= 1;
                    });
                    if (suitableNoodles.length === 0) suitableNoodles = noodleMenus;
                    
                    const selectedNoodle = suitableNoodles[Math.floor(Math.random() * suitableNoodles.length)];
                    const selectedSalad = saladMenus[Math.floor(Math.random() * saladMenus.length)];
                    const selectedSide = sideMenus[Math.floor(Math.random() * sideMenus.length)];
                    
                    const totalPrice = selectedNoodle.price + selectedSalad.price + selectedSide.price;
                    
                    // è¾›ã•èª¿æ•´
                    const adjustedNoodle = {
                        ...selectedNoodle,
                        adjustedSpiciness: spiciness,
                        originalSpiciness: selectedNoodle.spicyLevel
                    };
                    
                    return {
                        menu: adjustedNoodle,
                        extraMenus: [selectedSalad, selectedSide],
                        totalPrice: totalPrice,
                        comment: generateLuxuryComment(adjustedNoodle, selectedSalad, selectedSide, selections),
                        allergyWarning: generateAllergyWarning(adjustedNoodle, allergies)
                    };
                }
            }
            
            // æ™®é€šäºˆç®—ã®å ´åˆã®å‡¦ç†ï¼ˆæ‹…ã€…éººã¾ãŸã¯æ¹¯éººã‹ã‚‰1å“ï¼‰
            if (selections.budget === 'normal') {
                // æ‹…ã€…éººã¾ãŸã¯æ¹¯éººã‹ã‚‰é¸æŠ
                const noodleMenus = [...menuDatabase.tantanmen, ...menuDatabase.yunmen].filter(menu => 
                    !allergies.some(allergen => menu.allergens.includes(allergen)) &&
                    menu.price <= budget.max
                );
                
                if (noodleMenus.length > 0) {
                    // è¾›ã•ãƒ¬ãƒ™ãƒ«ã«é©ã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å„ªå…ˆé¸æŠ
                    let suitableNoodles = noodleMenus.filter(menu => {
                        if (menu.spicyLevel === 0) return true; // è¾›ããªã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯å¸¸ã«é©ç”¨
                        return Math.abs(menu.spicyLevel - spiciness) <= 1; // Â±1ãƒ¬ãƒ™ãƒ«ã¾ã§è¨±å®¹
                    });
                    if (suitableNoodles.length === 0) suitableNoodles = noodleMenus;
                    
                    const selectedNoodle = suitableNoodles[Math.floor(Math.random() * suitableNoodles.length)];
                    
                    // è¾›ã•èª¿æ•´
                    const adjustedMenu = {
                        ...selectedNoodle,
                        adjustedSpiciness: spiciness,
                        originalSpiciness: selectedNoodle.spicyLevel
                    };
                    
                    return {
                        menu: adjustedMenu,
                        comment: generateComment(adjustedMenu, selections),
                        allergyWarning: generateAllergyWarning(adjustedMenu, allergies)
                    };
                }
            }
            
            // æ§ãˆã‚äºˆç®—ã®å ´åˆã®å‡¦ç†ï¼ˆã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¾ãŸã¯ã‚µãƒ©ãƒ€ã‹ã‚‰é¸æŠï¼‰
            if (selections.budget === 'light') {
                // ã‚µãƒ©ãƒ€ã¾ãŸã¯ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰600å††ä»¥ä¸‹ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠ
                const lightMenus = [...menuDatabase.salads, ...menuDatabase.sides].filter(menu => 
                    !allergies.some(allergen => menu.allergens.includes(allergen)) &&
                    menu.price <= 600
                );
                
                if (lightMenus.length > 0) {
                    // æ°—åˆ†ã«å¿œã˜ãŸé¸æŠ
                    let filteredMenus;
                    if (mood === 'healthy') {
                        // ã‚ã£ã•ã‚Šç³»ï¼šã‚µãƒ©ãƒ€ã‚’å„ªå…ˆ
                        filteredMenus = lightMenus.filter(menu => menu.category === 'salad');
                        if (filteredMenus.length === 0) filteredMenus = lightMenus;
                    } else if (mood === 'hearty') {
                        // ãŒã£ã¤ã‚Šç³»ï¼šã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å„ªå…ˆ
                        filteredMenus = lightMenus.filter(menu => menu.category === 'side');
                        if (filteredMenus.length === 0) filteredMenus = lightMenus;
                    } else {
                        filteredMenus = lightMenus;
                    }
                    
                    const selectedMenu = filteredMenus[Math.floor(Math.random() * filteredMenus.length)];
                    
                    return {
                        menu: selectedMenu,
                        comment: generateLightBudgetComment(selectedMenu, selections),
                        allergyWarning: generateAllergyWarning(selectedMenu, allergies)
                    };
                }
            }
            
            // ãã®ä»–ã®äºˆç®—ã§ã®æ°—åˆ†ã«å¿œã˜ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ
            let selectedMenu;
            if (mood === 'hearty') {
                // ãŒã£ã¤ã‚Šç³»ï¼šãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼æ‹…ã€…éººã€ã‚»ãƒƒãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å„ªå…ˆ
                const heartyMenus = availableMenus.filter(menu => 
                    menu.name.includes('ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼') || 
                    menu.name.includes('ã‚»ãƒƒãƒˆ') || 
                    menu.category === 'tantanmen'
                );
                selectedMenu = heartyMenus.length > 0 ? 
                    heartyMenus[Math.floor(Math.random() * heartyMenus.length)] :
                    availableMenus[Math.floor(Math.random() * availableMenus.length)];
            } else if (mood === 'healthy') {
                // ã‚ã£ã•ã‚Šç³»ï¼šã‚µãƒ©ãƒ€ã€æ¹¯éººã‚’å„ªå…ˆ
                const healthyMenus = availableMenus.filter(menu => 
                    menu.category === 'salad' || 
                    menu.category === 'yunmen' ||
                    menu.name.includes('ãƒˆãƒãƒˆ')
                );
                selectedMenu = healthyMenus.length > 0 ? 
                    healthyMenus[Math.floor(Math.random() * healthyMenus.length)] :
                    availableMenus[Math.floor(Math.random() * availableMenus.length)];
            } else {
                // é€šå¸¸é¸æŠ
                selectedMenu = availableMenus[Math.floor(Math.random() * availableMenus.length)];
            }
            
            // è¾›ã•èª¿æ•´
            const adjustedMenu = {
                ...selectedMenu,
                adjustedSpiciness: spiciness,
                originalSpiciness: selectedMenu.spicyLevel
            };
            
            return {
                menu: adjustedMenu,
                comment: generateComment(adjustedMenu, selections),
                allergyWarning: generateAllergyWarning(adjustedMenu, allergies)
            };
        }

        function getBudgetRange(budget) {
            switch(budget) {
                case 'luxury': return {max: 1500, min: 1200};
                case 'normal': return {max: 1200, min: 800};
                case 'light': return {max: 800, min: 600};
                default: return {max: 1000, min: 700};
            }
        }

        function generateVisitorTypeComment(visitorType, menu, selections) {
            const comments = [];
            
            // æ¥åº—ã‚¿ã‚¤ãƒ—åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (visitorType === 'first-male') {
                comments.push('ã‚‰ã‚“ã¦ã‚“ã®å®šç•ªã‚’ã—ã£ã‹ã‚Šå‘³ã‚ãˆã‚‹æº€è¶³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™');
                comments.push('åˆå›æ¥åº—ã«ãŠã™ã™ã‚ã®äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™');
                comments.push('ãƒœãƒªãƒ¥ãƒ¼ãƒ æº€ç‚¹ã§æº€è¶³ã„ãŸã ã‘ã‚‹ã¨æ€ã„ã¾ã™');
            } else if (visitorType === 'first-female') {
                comments.push('ãƒ˜ãƒ«ã‚·ãƒ¼ã§ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„ã€ã‚‰ã‚“ã¦ã‚“ãŠã™ã™ã‚ã®çµ„ã¿åˆã‚ã›ã§ã™');
                comments.push('å¥³æ€§ã«äººæ°—ã®ãƒ˜ãƒ«ã‚·ãƒ¼ã‚»ãƒƒãƒˆã§ã™');
                comments.push('ç¾å‘³ã—ãã¦ä½“ã«å„ªã—ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ææ¡ˆã—ã¾ã—ãŸ');
            } else if (visitorType === 'with-kids') {
                comments.push('ãŠå­æ§˜ã¨ä¸€ç·’ã«ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã‚‹ã€å„ªã—ã„å‘³ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™');
                comments.push('ãŠå­æ§˜ã§ã‚‚å®‰å¿ƒã—ã¦ãŠå¬ã—ä¸ŠãŒã‚Šã„ãŸã ã‘ã¾ã™');
                comments.push('å–ã‚Šåˆ†ã‘ã—ã‚„ã™ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ææ¡ˆã—ã¾ã—ãŸ');
            } else if (visitorType === 'returning') {
                comments.push('ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ã®æ–¹ã«ãŠã™ã™ã‚ï¼ã„ã¤ã‚‚ã¨é•ã†çµ„ã¿åˆã‚ã›ã‚’ãŠè©¦ã—ãã ã•ã„');
                comments.push('å¸¸é€£æ§˜å‘ã‘ã®ç‰¹åˆ¥ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ææ¡ˆã„ãŸã—ã¾ã™');
                comments.push('æ–°ã—ã„å‘³ã®ç™ºè¦‹ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„');
                if (menu.isSignature) {
                    comments.push('ã‚‰ã‚“ã¦ã‚“è‡ªæ…¢ã®åç‰©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™ï¼');
                }
            }
            
            // è¾›ã•åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.spiciness === 0) {
                comments.push('è¾›å‘³ã‚’ä½¿ã‚ãªã„ã€ãŠå­æ§˜ã§ã‚‚å®‰å¿ƒã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™');
            } else if (selections.spiciness === 2) {
                comments.push('è¾›ã„ã®ãŒè‹¦æ‰‹ãªæ–¹ã‚‚å®‰å¿ƒã€ã¾ã‚ã‚„ã‹ãªæ‹…ã€…éººã§ã™');
            } else if (selections.spiciness === 3) {
                comments.push('ã‚‰ã‚“ã¦ã‚“ã®åŸºæœ¬ã®è¾›ã•ã€èƒ¡éº»ã®é¢¨å‘³ãŒéš›ç«‹ã¡ã¾ã™');
            } else if (selections.spiciness === 4) {
                comments.push('ã—ã£ã‹ã‚Šã¨ã—ãŸè¾›ã•ã§ã€æº€è¶³æ„Ÿã®ã‚ã‚‹ä¸€æ¯ã§ã™');
            } else if (selections.spiciness === 5) {
                comments.push('è¾›å…šã®æ–¹å¿…è¦‹ï¼æœ¬æ ¼å››å·ã®åˆºæ¿€ã‚’ã”å ªèƒ½ãã ã•ã„');
            }
            
            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.allergies.length > 0) {
                comments.push('ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã«é…æ…®ã—ãŸå®‰å¿ƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ææ¡ˆã—ã¾ã—ãŸ');
            }
            
            // æ°—åˆ†åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.mood === 'hearty') {
                comments.push('ãŒã£ã¤ã‚Šç³»ã§ãŠè…¹ã„ã£ã±ã„ã«ãªã‚Šã¾ã™');
            } else if (selections.mood === 'healthy') {
                comments.push('ã‚ã£ã•ã‚Šãƒ˜ãƒ«ã‚·ãƒ¼ã§åˆå¾Œã‚‚ã™ã£ãã‚Š');
            }
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function generateComment(menu, selections) {
            const comments = [];
            
            // åç‰©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å ´åˆ
            if (menu.isSignature) {
                comments.push('ã‚‰ã‚“ã¦ã‚“ã®åç‰©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™ï¼ãƒŸã‚·ãƒ¥ãƒ©ãƒ³ã‚¬ã‚¤ãƒ‰æ²è¼‰ã‚·ã‚§ãƒ•ã®æŠ€ã‚’ã”å ªèƒ½ãã ã•ã„ã€‚');
                return comments[0];
            }
            
            // äºˆç®—åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.budget === 'luxury') {
                comments.push('ä»Šæ—¥ã¯ç‰¹åˆ¥ãªæ—¥ï¼ã‚‰ã‚“ã¦ã‚“ã®ä¸€ç•ªè´…æ²¢ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã„ã‹ãŒï¼Ÿ');
            } else if (selections.budget === 'normal') {
                comments.push('ã‚‰ã‚“ã¦ã‚“ã®å®šç•ªã€æ‹…ã€…éººã®ç¾å‘³ã—ã•ã‚’ã—ã£ã‹ã‚Šå‘³ã‚ãˆã¾ã™');
            } else {
                comments.push('ãƒ˜ãƒ«ã‚·ãƒ¼ã«æ±ºã‚ã‚‹ãªã‚‰ã€æ–°é®®ã‚µãƒ©ãƒ€ãŒãŠã™ã™ã‚ï¼');
            }
            
            // è¾›ã•åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.spiciness <= 2) {
                comments.push('è¾›ã„ã®ãŒè‹¦æ‰‹ãªæ–¹ã‚‚å®‰å¿ƒã€ã¾ã‚ã‚„ã‹ãªæ‹…ã€…éººã§ã™');
            } else if (selections.spiciness === 3) {
                comments.push('ã‚‰ã‚“ã¦ã‚“ã®åŸºæœ¬ã®è¾›ã•ã€èƒ¡éº»ã®é¢¨å‘³ãŒéš›ç«‹ã¡ã¾ã™');
            } else {
                comments.push('è¾›å…šã®æ–¹å¿…è¦‹ï¼æœ¬æ ¼å››å·ã®åˆºæ¿€ã‚’ã”å ªèƒ½ãã ã•ã„');
            }
            
            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.allergies.length > 0) {
                comments.push('ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã«é…æ…®ã—ãŸå®‰å¿ƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ææ¡ˆã—ã¾ã—ãŸ');
            } else {
                comments.push('ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®å¿ƒé…ãªãã€ãŠå¥½ããªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã©ã†ãï¼');
            }
            
            // æ°—åˆ†åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.mood === 'hearty') {
                comments.push('ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼ãŸã£ã·ã‚Šï¼æº€è…¹é–“é•ã„ãªã—ã®çµ„ã¿åˆã‚ã›');
            } else if (selections.mood === 'healthy') {
                comments.push('é‡èœãŸã£ã·ã‚Šã§ãƒ˜ãƒ«ã‚·ãƒ¼ã€ä½“ã«å„ªã—ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™');
            }
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function generateLuxuryComment(noodle, salad, side, selections) {
            const comments = [
                'è´…æ²¢ãª3å“ã‚»ãƒƒãƒˆã§ç‰¹åˆ¥ãªãŠé£Ÿäº‹ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼',
                'ã‚‰ã‚“ã¦ã‚“è‡ªæ…¢ã®ã‚³ãƒ¼ã‚¹æ–™ç†ã‚¹ã‚¿ã‚¤ãƒ«ã§ã”æä¾›ã„ãŸã—ã¾ã™',
                'éººãƒ»ã‚µãƒ©ãƒ€ãƒ»ã‚µã‚¤ãƒ‰ã®çµ¶å¦™ãªãƒãƒ©ãƒ³ã‚¹ãŒè‡ªæ…¢ã®ã‚»ãƒƒãƒˆã§ã™',
                'ä»Šæ—¥ã¯ç‰¹åˆ¥ï¼ã‚‰ã‚“ã¦ã‚“ã®ç¾å‘³ã—ã•ã‚’å­˜åˆ†ã«å‘³ã‚ãˆã‚‹ã‚»ãƒƒãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼'
            ];
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function generateLightBudgetComment(menu, selections) {
            const comments = [];
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç¨®é¡åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (menu.category === 'salad') {
                comments.push('ãƒ˜ãƒ«ã‚·ãƒ¼ã§æ–°é®®ãªã‚µãƒ©ãƒ€ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼');
                comments.push('é‡èœãŸã£ã·ã‚Šã§ä½“ã«å„ªã—ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™');
                comments.push('ãƒªãƒ¼ã‚ºãƒŠãƒ–ãƒ«ã§ã‚‚æº€è¶³æ„Ÿã®ã‚ã‚‹ã‚µãƒ©ãƒ€ã§ã™');
            } else if (menu.category === 'side') {
                comments.push('ãŠæ‰‹è»½ä¾¡æ ¼ã§ç¾å‘³ã—ã„ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™ï¼');
                comments.push('å°è…¹ãŒç©ºã„ãŸæ™‚ã«ã´ã£ãŸã‚Šã®ä¸€å“');
                comments.push('æ§ãˆã‚äºˆç®—ã§ã‚‚æº€è¶³ã„ãŸã ã‘ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™');
            }
            
            // æ°—åˆ†åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.mood === 'healthy') {
                comments.push('ã‚ã£ã•ã‚Šãƒ˜ãƒ«ã‚·ãƒ¼ã§åˆå¾Œã‚‚ã™ã£ãã‚Š');
            } else if (selections.mood === 'hearty') {
                comments.push('å°ã•ãã¦ã‚‚æº€è¶³æ„Ÿã®ã‚ã‚‹ä¸€å“ã§ã™');
            }
            
            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã‚³ãƒ¡ãƒ³ãƒˆ
            if (selections.allergies.length > 0) {
                comments.push('ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã«é…æ…®ã—ãŸå®‰å¿ƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™');
            }
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function generateAllergyWarning(menu, userAllergies) {
            if (userAllergies.length === 0) return null;
            
            const menuAllergens = menu.allergens || [];
            const commonAllergens = menuAllergens.filter(allergen => 
                !userAllergies.includes(allergen)
            );
            
            if (menuAllergens.length > 0) {
                return `ã“ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«å«ã¾ã‚Œã‚‹ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³: ${menuAllergens.join('ã€')}`;
            }
            
            return null;
        }

        // æ¥åº—ã‚¿ã‚¤ãƒ—åˆ¥æ¨è–¦é–¢æ•°
        function createFirstMaleSuggestion(spiciness, allergies, mood) {
            // åˆã‚ã¦ã®æ–¹ï¼ˆç”·æ€§ï¼‰: æ‹…ã€…éººã‚’å¿…ãšææ¡ˆ
            const tantanmenMenus = menuDatabase.tantanmen.filter(menu => 
                !allergies.some(allergen => menu.allergens.includes(allergen))
            );
            
            if (tantanmenMenus.length === 0) {
                return createGenericSuggestion(spiciness, allergies, mood);
            }
            
            // è¾›ã•ãƒ¬ãƒ™ãƒ«ã«é©ã—ãŸæ‹…ã€…éººã‚’é¸æŠ
            let suitableMenus = tantanmenMenus.filter(menu => 
                Math.abs(menu.spicyLevel - spiciness) <= 1
            );
            if (suitableMenus.length === 0) suitableMenus = tantanmenMenus;
            
            const selectedMenu = suitableMenus[Math.floor(Math.random() * suitableMenus.length)];
            
            // ãŒã£ã¤ã‚Šç³»ã®å ´åˆã¯3å“ã‚»ãƒƒãƒˆã‚’ææ¡ˆ
            if (mood === 'hearty') {
                return createHeartySet(selectedMenu, spiciness, allergies, 'first-male');
            }
            
            return {
                menu: { ...selectedMenu, adjustedSpiciness: spiciness, originalSpiciness: selectedMenu.spicyLevel },
                comment: generateVisitorTypeComment('first-male', selectedMenu, { spiciness, allergies, mood }),
                allergyWarning: generateAllergyWarning(selectedMenu, allergies)
            };
        }

        function createFirstFemaleSuggestion(spiciness, allergies, mood) {
            // åˆã‚ã¦ã®æ–¹ï¼ˆå¥³æ€§ï¼‰: æ‹…ã€…éººã‚’å¿…ãšææ¡ˆ
            const tantanmenMenus = menuDatabase.tantanmen.filter(menu => 
                !allergies.some(allergen => menu.allergens.includes(allergen))
            );
            
            if (tantanmenMenus.length === 0) {
                return createGenericSuggestion(spiciness, allergies, mood);
            }
            
            // è¾›ã•ãƒ¬ãƒ™ãƒ«ã«é©ã—ãŸæ‹…ã€…éººã‚’é¸æŠ
            let suitableMenus = tantanmenMenus.filter(menu => 
                Math.abs(menu.spicyLevel - spiciness) <= 1
            );
            if (suitableMenus.length === 0) suitableMenus = tantanmenMenus;
            
            const selectedMenu = suitableMenus[Math.floor(Math.random() * suitableMenus.length)];
            
            // ãŒã£ã¤ã‚Šç³»ã®å ´åˆã¯3å“ã‚»ãƒƒãƒˆã‚’ææ¡ˆ
            if (mood === 'hearty') {
                return createHeartySet(selectedMenu, spiciness, allergies, 'first-female');
            }
            
            // ãƒ˜ãƒ«ã‚·ãƒ¼å¿—å‘ãªã®ã§ã€ã‚µãƒ©ãƒ€ã‚’è¿½åŠ 
            const saladMenus = menuDatabase.salads.filter(salad => 
                !allergies.some(allergen => salad.allergens.includes(allergen))
            );
            
            if (saladMenus.length > 0) {
                const selectedSalad = saladMenus[Math.floor(Math.random() * saladMenus.length)];
                return {
                    menu: { ...selectedMenu, adjustedSpiciness: spiciness, originalSpiciness: selectedMenu.spicyLevel },
                    extraMenus: [selectedSalad],
                    totalPrice: selectedMenu.price + selectedSalad.price,
                    comment: generateVisitorTypeComment('first-female', selectedMenu, { spiciness, allergies, mood }),
                    allergyWarning: generateAllergyWarning(selectedMenu, allergies)
                };
            }
            
            return {
                menu: { ...selectedMenu, adjustedSpiciness: spiciness, originalSpiciness: selectedMenu.spicyLevel },
                comment: generateVisitorTypeComment('first-female', selectedMenu, { spiciness, allergies, mood }),
                allergyWarning: generateAllergyWarning(selectedMenu, allergies)
            };
        }

        function createWithKidsSuggestion(spiciness, allergies, mood) {
            // ãŠå­æ§˜é€£ã‚Œã®æ–¹: è¾›ã•ãªã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å¿…ãšææ¡ˆ
            // è¾›ã•ãƒ¬ãƒ™ãƒ«0ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¾ãŸã¯æ¹¯éººã‚’å„ªå…ˆ
            const noSpiceMenus = [...menuDatabase.tanmen, ...menuDatabase.salads, ...menuDatabase.sides]
                .filter(menu => 
                    menu.spicyLevel === 0 &&
                    !allergies.some(allergen => menu.allergens.includes(allergen))
                );
            
            // è¾›ã•ãƒ¬ãƒ™ãƒ«0ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒãªã„å ´åˆã¯ã€è¾›ã•ãƒ¬ãƒ™ãƒ«1ã®æ¹¯éººã‚’é¸æŠ
            if (noSpiceMenus.length === 0) {
                const mildTanmenMenus = menuDatabase.tanmen.filter(menu => 
                    menu.spicyLevel <= 1 &&
                    !allergies.some(allergen => menu.allergens.includes(allergen))
                );
                
                if (mildTanmenMenus.length > 0) {
                    const selectedMenu = mildTanmenMenus[Math.floor(Math.random() * mildTanmenMenus.length)];
                    
                    // ãŒã£ã¤ã‚Šç³»ã®å ´åˆã¯3å“ã‚»ãƒƒãƒˆã‚’ææ¡ˆ
                    if (mood === 'hearty') {
                        return createHeartySet(selectedMenu, 0, allergies, 'with-kids'); // è¾›ã•ã‚’0ã«å›ºå®š
                    }
                    
                    return {
                        menu: { ...selectedMenu, adjustedSpiciness: 0, originalSpiciness: selectedMenu.spicyLevel },
                        comment: generateVisitorTypeComment('with-kids', selectedMenu, { spiciness: 0, allergies, mood }),
                        allergyWarning: generateAllergyWarning(selectedMenu, allergies)
                    };
                }
                
                return createGenericSuggestion(0, allergies, mood); // è¾›ã•ã‚’0ã«å›ºå®š
            }
            
            const selectedMenu = noSpiceMenus[Math.floor(Math.random() * noSpiceMenus.length)];
            
            // ãŒã£ã¤ã‚Šç³»ã®å ´åˆã¯3å“ã‚»ãƒƒãƒˆã‚’ææ¡ˆ
            if (mood === 'hearty') {
                return createHeartySet(selectedMenu, 0, allergies, 'with-kids'); // è¾›ã•ã‚’0ã«å›ºå®š
            }
            
            return {
                menu: { ...selectedMenu, adjustedSpiciness: 0, originalSpiciness: selectedMenu.spicyLevel },
                comment: generateVisitorTypeComment('with-kids', selectedMenu, { spiciness: 0, allergies, mood }),
                allergyWarning: generateAllergyWarning(selectedMenu, allergies)
            };
        }

        function createReturningSuggestion(spiciness, allergies, mood) {
            // ï¼’å›ä»¥ä¸Šæ¥åº—: æ‹…ã€…éººä»¥å¤–ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ææ¡ˆ
            
            // æ¹¯éººã€ã‚µãƒ©ãƒ€ã€ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰é¸æŠï¼ˆæ‹…ã€…éººã‚’é™¤å¤–ï¼‰
            const nonTantanmenMenus = [...menuDatabase.tanmen, ...menuDatabase.salads, ...menuDatabase.sides]
                .filter(menu => 
                    !allergies.some(allergen => menu.allergens.includes(allergen)) &&
                    (spiciness === 0 ? menu.spicyLevel <= 1 : Math.abs(menu.spicyLevel - spiciness) <= 2)
                );
            
            if (nonTantanmenMenus.length === 0) {
                return createGenericSuggestion(spiciness, allergies, mood);
            }
            
            // æ¹¯éººã‚’å„ªå…ˆçš„ã«é¸æŠ
            let priorityMenus = nonTantanmenMenus.filter(menu => menu.category === 'tanmen');
            if (priorityMenus.length === 0) priorityMenus = nonTantanmenMenus;
            
            const selectedMenu = priorityMenus[Math.floor(Math.random() * priorityMenus.length)];
            
            // ãŒã£ã¤ã‚Šç³»ã®å ´åˆã¯3å“ã‚»ãƒƒãƒˆã‚’ææ¡ˆ
            if (mood === 'hearty') {
                return createHeartySet(selectedMenu, spiciness, allergies, 'returning');
            }
            
            // å†’é™ºçš„ãªçµ„ã¿åˆã‚ã›ã¨ã—ã¦ã€ã‚µãƒ©ãƒ€ã‚„ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ 
            const saladMenus = menuDatabase.salads.filter(salad => 
                !allergies.some(allergen => salad.allergens.includes(allergen))
            );
            
            const sideMenus = menuDatabase.sides.filter(side => 
                !allergies.some(allergen => side.allergens.includes(allergen))
            );
            
            // 50%ã®ç¢ºç‡ã§ã‚µãƒ©ãƒ€ã¾ãŸã¯ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ 
            if (Math.random() < 0.5 && (saladMenus.length > 0 || sideMenus.length > 0)) {
                const extraMenu = Math.random() < 0.5 && saladMenus.length > 0 ? 
                    saladMenus[Math.floor(Math.random() * saladMenus.length)] :
                    sideMenus[Math.floor(Math.random() * sideMenus.length)];
                
                return {
                    menu: { ...selectedMenu, adjustedSpiciness: spiciness, originalSpiciness: selectedMenu.spicyLevel },
                    extraMenus: [extraMenu],
                    totalPrice: selectedMenu.price + extraMenu.price,
                    comment: generateVisitorTypeComment('returning', selectedMenu, { spiciness, allergies, mood }),
                    allergyWarning: generateAllergyWarning(selectedMenu, allergies)
                };
            }
            
            return {
                menu: { ...selectedMenu, adjustedSpiciness: spiciness, originalSpiciness: selectedMenu.spicyLevel },
                comment: generateVisitorTypeComment('returning', selectedMenu, { spiciness, allergies, mood }),
                allergyWarning: generateAllergyWarning(selectedMenu, allergies)
            };
        }

        function createHeartySet(baseMenu, spiciness, allergies, visitorType) {
            // ãŒã£ã¤ã‚Šç³»é¸æŠæ™‚ã®3å“ã‚»ãƒƒãƒˆææ¡ˆæ©Ÿèƒ½
            const saladMenus = menuDatabase.salads.filter(salad => 
                !allergies.some(allergen => salad.allergens.includes(allergen))
            );
            
            const sideMenus = menuDatabase.sides.filter(side => 
                !allergies.some(allergen => side.allergens.includes(allergen))
            );
            
            const extraMenus = [];
            let totalPrice = baseMenu.price;
            
            // ã‚µãƒ©ãƒ€ã‚’è¿½åŠ 
            if (saladMenus.length > 0) {
                const selectedSalad = saladMenus[Math.floor(Math.random() * saladMenus.length)];
                extraMenus.push(selectedSalad);
                totalPrice += selectedSalad.price;
            }
            
            // ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ 
            if (sideMenus.length > 0) {
                const selectedSide = sideMenus[Math.floor(Math.random() * sideMenus.length)];
                extraMenus.push(selectedSide);
                totalPrice += selectedSide.price;
            }
            
            return {
                menu: { ...baseMenu, adjustedSpiciness: spiciness, originalSpiciness: baseMenu.spicyLevel },
                extraMenus: extraMenus,
                totalPrice: totalPrice,
                comment: generateVisitorTypeComment(visitorType, baseMenu, { spiciness, allergies, mood: 'hearty' }),
                allergyWarning: generateAllergyWarning(baseMenu, allergies)
            };
        }

        function createGenericSuggestion(spiciness, allergies, mood) {
            // æ±ç”¨çš„ãªæ¨è–¦ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
            const allMenus = menuDatabase.getAllMenus().filter(menu => 
                !allergies.some(allergen => menu.allergens.includes(allergen))
            );
            
            if (allMenus.length === 0) {
                return {
                    menu: null,
                    comment: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åº—èˆ—ã‚¹ã‚¿ãƒƒãƒ•ã«ã”ç›¸è«‡ãã ã•ã„ã€‚',
                    allergyWarning: null
                };
            }
            
            const selectedMenu = allMenus[Math.floor(Math.random() * allMenus.length)];
            return {
                menu: { ...selectedMenu, adjustedSpiciness: spiciness, originalSpiciness: selectedMenu.spicyLevel },
                comment: generateComment(selectedMenu, { spiciness, allergies, mood }),
                allergyWarning: generateAllergyWarning(selectedMenu, allergies)
            };
        }

        function createFallbackSuggestion(budget, allergies) {
            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã®å®‰å…¨ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ææ¡ˆ
            const safeMenus = menuDatabase.salads.filter(menu => 
                menu.allergens.length === 0 && menu.price <= budget.max
            );
            
            if (safeMenus.length > 0) {
                return {
                    menu: safeMenus[0],
                    comment: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã«é…æ…®ã—ãŸå®‰å…¨ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠé¸ã³ã—ã¾ã—ãŸã€‚',
                    allergyWarning: null
                };
            }
            
            return {
                menu: {
                    name: 'ã‚¹ã‚¿ãƒƒãƒ•ã«ã”ç›¸è«‡ãã ã•ã„',
                    price: 0,
                    description: 'ãŠå®¢æ§˜ã®ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ã‚’è€ƒæ…®ã—ãŸç‰¹åˆ¥ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã”ææ¡ˆã„ãŸã—ã¾ã™ã€‚'
                },
                comment: 'ãŠå®¢æ§˜ã®ã”è¦æœ›ã«åˆã‚ã›ã¦ã‚¹ã‚¿ãƒƒãƒ•ãŒå€‹åˆ¥ã«ã”ææ¡ˆã„ãŸã—ã¾ã™ã€‚',
                allergyWarning: null
            };
        }

        function displaySuggestion(suggestion) {
            const menuItems = document.getElementById('menu-items');
            const commentText = document.getElementById('comment-text');
            const allergyWarning = document.getElementById('allergy-warning');
            const allergyWarningText = document.getElementById('allergy-warning-text');
            
            menuItems.innerHTML = '';
            
            const menu = suggestion.menu;
            let totalPrice = menu.price;
            
            // ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item';
            
            let spicyIndicator = '';
            if (menu.adjustedSpiciness && menu.adjustedSpiciness > 0) {
                const spicyLevel = menuDatabase.spicyLevels[menu.adjustedSpiciness];
                spicyIndicator = ` (è¾›ã•${menu.adjustedSpiciness}: ${spicyLevel.name})`;
            }
            
            let signatureBadge = '';
            if (menu.isSignature) {
                signatureBadge = '<span class="signature-badge">åç‰©</span>';
            }
            
            menuItem.innerHTML = `
                <div class="menu-name">ğŸœ ${menu.name}${spicyIndicator}${signatureBadge}</div>
                <div class="menu-price">${menu.price}å††</div>
            `;
            menuItems.appendChild(menuItem);
            
            // ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆã‚µãƒ©ãƒ€ï¼‰ãŒã‚ã‚‹å ´åˆ
            if (suggestion.extraMenu) {
                const extraItem = document.createElement('div');
                extraItem.className = 'menu-item';
                extraItem.innerHTML = `
                    <div class="menu-name">ğŸ¥— ${suggestion.extraMenu.name}</div>
                    <div class="menu-price">${suggestion.extraMenu.price}å††</div>
                `;
                menuItems.appendChild(extraItem);
                totalPrice += suggestion.extraMenu.price;
            }
            
            // è´…æ²¢ã‚»ãƒƒãƒˆã®è¤‡æ•°ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚‹å ´åˆ
            if (suggestion.extraMenus) {
                suggestion.extraMenus.forEach((extraMenu, index) => {
                    const extraItem = document.createElement('div');
                    extraItem.className = 'menu-item';
                    const icon = index === 0 ? 'ğŸ¥—' : 'ğŸ½ï¸';
                    extraItem.innerHTML = `
                        <div class="menu-name">${icon} ${extraMenu.name}</div>
                        <div class="menu-price">${extraMenu.price}å††</div>
                    `;
                    menuItems.appendChild(extraItem);
                    totalPrice += extraMenu.price;
                });
            }
            
            // åˆè¨ˆé‡‘é¡ã‚’è¡¨ç¤º
            const totalItem = document.createElement('div');
            totalItem.className = 'menu-item';
            const finalPrice = suggestion.totalPrice || totalPrice;
            totalItem.innerHTML = `
                <div class="menu-name">ğŸ’° åˆè¨ˆé‡‘é¡</div>
                <div class="menu-price">${finalPrice}å††</div>
            `;
            menuItems.appendChild(totalItem);
            
            commentText.textContent = suggestion.comment;
            
            if (suggestion.allergyWarning) {
                allergyWarningText.textContent = suggestion.allergyWarning;
                allergyWarning.style.display = 'block';
            } else {
                allergyWarning.style.display = 'none';
            }
        }

        function adjustSpiciness(adjustment) {
            if (!currentSuggestion || !currentSuggestion.menu) return;
            
            const currentLevel = currentSuggestion.menu.adjustedSpiciness || currentSuggestion.menu.spicyLevel;
            const newLevel = Math.max(1, Math.min(5, currentLevel + adjustment));
            
            if (newLevel !== currentLevel) {
                currentSuggestion.menu.adjustedSpiciness = newLevel;
                
                // è¾›ã•ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–°
                const spicyLevel = menuDatabase.spicyLevels[newLevel];
                if (adjustment > 0) {
                    currentSuggestion.comment = `è¾›ã•ã‚’${newLevel}ã«èª¿æ•´ã—ã¾ã—ãŸã€‚${spicyLevel.description}`;
                } else if (adjustment < 0) {
                    currentSuggestion.comment = `è¾›ã•ã‚’${newLevel}ã«èª¿æ•´ã—ã¾ã—ãŸã€‚${spicyLevel.description}`;
                } else {
                    currentSuggestion.comment = `æ¨™æº–ã®è¾›ã•ï¼ˆãƒ¬ãƒ™ãƒ«${newLevel}ï¼‰ã§ã™ã€‚${spicyLevel.description}`;
                }
                
                displaySuggestion(currentSuggestion);
            }
        }

        function displayFinalDecision() {
            if (!currentSuggestion) return;
            
            const finalMenuItems = document.getElementById('final-menu-items');
            const finalCommentText = document.getElementById('final-comment-text');
            
            finalMenuItems.innerHTML = '';
            
            const menu = currentSuggestion.menu;
            let totalPrice = menu.price;
            
            // ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item';
            
            let spicyIndicator = '';
            if (menu.adjustedSpiciness && menu.adjustedSpiciness > 0) {
                const spicyLevel = menuDatabase.spicyLevels[menu.adjustedSpiciness];
                spicyIndicator = ` (è¾›ã•${menu.adjustedSpiciness}: ${spicyLevel.name})`;
            }
            
            let signatureBadge = '';
            if (menu.isSignature) {
                signatureBadge = '<span class="signature-badge">åç‰©</span>';
            }
            
            menuItem.innerHTML = `
                <div class="menu-name">ğŸœ ${menu.name}${spicyIndicator}${signatureBadge}</div>
                <div class="menu-price">${menu.price}å††</div>
            `;
            finalMenuItems.appendChild(menuItem);
            
            // ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆã‚µãƒ©ãƒ€ï¼‰ãŒã‚ã‚‹å ´åˆ
            if (currentSuggestion.extraMenu) {
                const extraItem = document.createElement('div');
                extraItem.className = 'menu-item';
                extraItem.innerHTML = `
                    <div class="menu-name">ğŸ¥— ${currentSuggestion.extraMenu.name}</div>
                    <div class="menu-price">${currentSuggestion.extraMenu.price}å††</div>
                `;
                finalMenuItems.appendChild(extraItem);
                totalPrice += currentSuggestion.extraMenu.price;
            }
            
            // è´…æ²¢ã‚»ãƒƒãƒˆã®è¤‡æ•°ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚‹å ´åˆ
            if (currentSuggestion.extraMenus) {
                currentSuggestion.extraMenus.forEach((extraMenu, index) => {
                    const extraItem = document.createElement('div');
                    extraItem.className = 'menu-item';
                    const icon = index === 0 ? 'ğŸ¥—' : 'ğŸ½ï¸';
                    extraItem.innerHTML = `
                        <div class="menu-name">${icon} ${extraMenu.name}</div>
                        <div class="menu-price">${extraMenu.price}å††</div>
                    `;
                    finalMenuItems.appendChild(extraItem);
                    totalPrice += extraMenu.price;
                });
            }
            
            // åˆè¨ˆé‡‘é¡ã‚’è¡¨ç¤º
            const totalItem = document.createElement('div');
            totalItem.className = 'menu-item';
            const finalPrice = currentSuggestion.totalPrice || totalPrice;
            totalItem.innerHTML = `
                <div class="menu-name">ğŸ’° åˆè¨ˆé‡‘é¡</div>
                <div class="menu-price">${finalPrice}å††</div>
            `;
            finalMenuItems.appendChild(totalItem);
            
            finalCommentText.textContent = `ã‚‰ã‚“ã¦ã‚“ã§ã®ç´ æ•µãªãŠé£Ÿäº‹ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼${currentSuggestion.comment}`;
        }

        function finalDecision() {
            displayFinalDecision();
            showFinalScreen();
        }

        function showResultScreen() {
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-screen').style.display = 'none';
        }

        function showFinalScreen() {
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('final-screen').style.display = 'block';
        }

        function goBack() {
            document.getElementById('selection-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('final-screen').style.display = 'none';
        }

        function restart() {
            // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            selections = {budget: null, spiciness: null, allergies: [], mood: null};
            
            // ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.choice-btn, .spicy-btn, .allergy-btn, .optional-btn, .no-allergy-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ææ¡ˆãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.getElementById('submit-btn').disabled = true;
            
            // æœ€åˆã®ç”»é¢ã‚’è¡¨ç¤º
            goBack();
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
        window.adjustSpiciness = adjustSpiciness;
        window.finalDecision = finalDecision;
        window.goBack = goBack;
        window.restart = restart;
    </script>
</body>
</html>